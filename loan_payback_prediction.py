# -*- coding: utf-8 -*-
"""Loan Payback Prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1BWevvu91ulLJtrebMBAfmTtXrI08eQDP
"""

from google.colab import files
files.upload()  # Upload kaggle.json

import os

# Rename uploaded file to remove spaces/parentheses
os.rename("kaggle (3).json", "kaggle.json")

!mkdir -p ~/.kaggle
!mv kaggle.json ~/.kaggle/
!chmod 600 ~/.kaggle/kaggle.json
!ls -l ~/.kaggle

!kaggle competitions download -c playground-series-s5e11

!unzip playground-series-s5e11.zip -d ./dataset
!ls ./dataset

import pandas as pd

train = pd.read_csv('./dataset/train.csv')
test = pd.read_csv('./dataset/test.csv')
sample_submission = pd.read_csv('./dataset/sample_submission.csv')

train.head()

import pandas as pd
from sklearn.preprocessing import StandardScaler

# 1️⃣ Fill missing values
numeric_cols = train.select_dtypes(include='number').columns.tolist()
numeric_cols.remove('loan_paid_back')

train[numeric_cols] = train[numeric_cols].fillna(train[numeric_cols].mean())
test[numeric_cols] = test[numeric_cols].fillna(train[numeric_cols].mean())

categorical_cols = train.select_dtypes(include='object').columns.tolist()
train[categorical_cols] = train[categorical_cols].fillna("Unknown")
test[categorical_cols] = test[categorical_cols].fillna("Unknown")

# 2️⃣ One-hot encode categorical features
train = pd.get_dummies(train, columns=categorical_cols, drop_first=True)
test = pd.get_dummies(test, columns=categorical_cols, drop_first=True)

# 3️⃣ Align train/test
X_train = train.drop(['loan_paid_back', 'id'], axis=1)
y_train = train['loan_paid_back']
X_test = test.drop(['id'], axis=1)
X_test = X_test.reindex(columns=X_train.columns, fill_value=0)

# 4️⃣ Scale numeric features
numeric_cols = X_train.select_dtypes(include='number').columns.tolist()
scaler = StandardScaler()
X_train[numeric_cols] = scaler.fit_transform(X_train[numeric_cols])
X_test[numeric_cols] = scaler.transform(X_test[numeric_cols])

# 5️⃣ Inspect
print(X_train.head())
print(X_train.shape)

import tensorflow as tf
from tensorflow.keras import layers, models

model = models.Sequential([
    layers.Input(shape=(X_train.shape[1],)),
    layers.Dense(128, activation='relu'),
    layers.Dropout(0.3),
    layers.Dense(64, activation='relu'),
    layers.Dropout(0.2),
    layers.Dense(1, activation='sigmoid')  # probability output
])

model.compile(
    optimizer='adam',
    loss='binary_crossentropy',
    metrics=[tf.keras.metrics.AUC(name='auc')]
)

model.summary()

history = model.fit(
    X_train, y_train,
    validation_split=0.2,
    epochs=30,
    batch_size=32
)

y_pred = model.predict(X_test)

submission = pd.DataFrame({
    'id': test['id'],
    'loan_paid_back': y_pred.flatten()
})

submission.to_csv('submission.csv', index=False)
submission.head()

!ls -lh submission.csv

from google.colab import files
files.download('submission.csv')